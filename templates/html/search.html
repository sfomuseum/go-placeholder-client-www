{{ define "search" }}
{{ template "header" . }}
    
{{ if .Query }}
    <div class="card">
	
	<h3 class="card-header">Query results for <q>{{ .Query }}</q></h3>

	<div class="card-body">
	    
	    {{if  .Error }}
	    
	    <div class="alert alert-warning" role="alert">
		<p>Unable to complete query successfully. Error reported is:</p>
		<code>{{ .Error }}</code>
	    </div>
	    
	    {{ else }}
	    
	    <div id="map"></div>
	    
	    <div id="results-table" class="table-responsive">
		<table class="table table-hover">
		    <tr>
			<th>ID</th>
			<th>Name</th>
			<th>Placetype</th>
			<th>Region</th>		
			<th>Country</th>
			<th>Latitude</th>
			<th>Longitude</th>		
		    </tr>
		    {{ range $i, $r := .Results }}
		    <tr class="result" id="result-{{ $r.Id }}" data-whosonfirst-id="{{ $r.Id }}" data-bounding-box="{{ $r.Geometry.BoundingBox }}">
			<td><a href="https://spelunker.whosonfirst.org/id/{{ $r.Id }}">{{ $r.Id }}</a></td>
			<td id="result-{{ $r.Id }}-name">{{ $r.Name }}</td>
			<td id="result-{{ $r.Id }}-placetype">{{ $r.Placetype }}</td>
			<td id="result-{{ $r.Id }}-country">{{ range $j, $rg := Ancestors $r "region" }}{{ $rg.Name }}{{ end }}</td>		
			<td id="result-{{ $r.Id }}-country">{{ range $j, $c := Ancestors $r "country" }}{{ $c.Name }}{{ end }}</td>
			<td id="result-{{ $r.Id }}-latitude">{{ $r.Geometry.Latitude }}</td>
			<td id="result-{{ $r.Id }}-longitude">{{ $r.Geometry.Longitude }}</td>		
		    </tr>
		    {{ end }}
		</table>
	    </div>
	    
	{{ end }}
	</div>
	
    </div>
    {{ end }}
    
{{ template "footer" . }}
{{ end }}
